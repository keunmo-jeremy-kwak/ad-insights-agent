name: Daily Ad Insights (Multi Recipients)

on:
  schedule:
    # ë§¤ì¼ ì˜¤ì „ 9ì‹œ (í•œêµ­ ì‹œê°„ = UTC 0ì‹œ)
    - cron: '0 0 * * *'
  workflow_dispatch:  # ìˆ˜ë™ ì‹¤í–‰ ê°€ëŠ¥

jobs:
  run-agent:
    runs-on: ubuntu-latest
    
    steps:
    - name: ì½”ë“œ ì²´í¬ì•„ì›ƒ
      uses: actions/checkout@v3
    
    - name: Python ì„¤ì •
      uses: actions/setup-python@v4
      with:
        python-version: '3.11'
    
    - name: íŒ¨í‚¤ì§€ ì„¤ì¹˜
      run: |
        python -m pip install --upgrade pip
        pip install -r requirements.txt
    
    - name: ë©€í‹° ìˆ˜ì‹ ì ì¸ì‚¬ì´íŠ¸ ì—ì´ì „íŠ¸ ì‹¤í–‰
      env:
        # API Key (í•„ìˆ˜)
        ANTHROPIC_API_KEY: ${{ secrets.ANTHROPIC_API_KEY }}
        
        # ìŠ¬ë™ Webhooks (ë°©ë²• 1: ì‰¼í‘œë¡œ êµ¬ë¶„)
        SLACK_WEBHOOK_URL: ${{ secrets.SLACK_WEBHOOK_URL }}
        
        # ìŠ¬ë™ Webhooks (ë°©ë²• 2: ê°œë³„ ì„¤ì •)
        SLACK_WEBHOOK_1: ${{ secrets.SLACK_WEBHOOK_1 }}
        SLACK_WEBHOOK_2: ${{ secrets.SLACK_WEBHOOK_2 }}
        SLACK_WEBHOOK_3: ${{ secrets.SLACK_WEBHOOK_3 }}
        
        # ì´ë©”ì¼ ê¸°ë³¸ ì„¤ì •
        SMTP_SERVER: smtp.gmail.com
        SMTP_PORT: 587
        FROM_EMAIL: ${{ secrets.FROM_EMAIL }}
        EMAIL_PASSWORD: ${{ secrets.EMAIL_PASSWORD }}
        
        # ë°›ëŠ” ì´ë©”ì¼ (ë°©ë²• 1: ì‰¼í‘œë¡œ êµ¬ë¶„)
        TO_EMAIL: ${{ secrets.TO_EMAIL }}
        
        # ë°›ëŠ” ì´ë©”ì¼ (ë°©ë²• 2: ê°œë³„ ì„¤ì •)
        TO_EMAIL_1: ${{ secrets.TO_EMAIL_1 }}
        TO_EMAIL_2: ${{ secrets.TO_EMAIL_2 }}
        TO_EMAIL_3: ${{ secrets.TO_EMAIL_3 }}
        
      run: |
        python multi_recipient_agent.py
    
    - name: ì‹¤í–‰ ê²°ê³¼ ìš”ì•½
      if: always()
      run: |
        echo "ğŸ‰ ì›Œí¬í”Œë¡œìš° ì‹¤í–‰ ì™„ë£Œ!"
        echo "ğŸ“Š ìˆ˜ì‹ ìë“¤ì—ê²Œ ë¦¬í¬íŠ¸ê°€ ì „ì†¡ë˜ì—ˆìŠµë‹ˆë‹¤."
